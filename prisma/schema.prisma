datasource mysql {
    provider = "mysql"
    url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
  previewFeatures = ["filterJson", "interactiveTransactions", "referentialIntegrity"]
  binaryTargets = ["native"]
}

model User {
  id                Int             @id @default(autoincrement())
  name              String
  email             String          @unique
  password          String
  role              Role            @default(USER)
  token             String?         @mysql.TinyText
  lastDocument      Document?       @relation(name: "lastUsed", fields: [lastDocumentId], references: [id])
  lastDocumentId    Int?
  documents         Document[]      @relation("document_user")

  @@map(name: "users")
}

model Document {
  id            Int             @id @default(autoincrement())
  name          String
  users         User[]          @relation("document_user")
  nodes         Node[]
  lastUsedBy    User[]          @relation("lastUsed")

  @@map(name: "documents")
}

model Node {
  id            Int             @id @default(autoincrement())
  name          String
  document      Document        @relation(fields: [documentId], references: [id])
  documentId    Int
  source        Source?

  parentId      Int?
  parent        Node?           @relation("TreeNodes", fields: [parentId], references: [id])
  nodes         Node[]          @relation("TreeNodes")

  @@map(name: "nodes")
}

model Source {
  id            Int             @id @default(autoincrement())
  type          SourceType
  schema        Json?
  config        Json?
  node          Node            @relation(fields: [nodeId], references: [id])
  nodeId        Int

  @@map(name: "sources")
}

enum SourceType {
  INTERNAL
  EXTERNAL
}

enum Role {
  USER
  ADMIN
}